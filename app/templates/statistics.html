<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Heart Disease Statistics & Insights</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
            color: #343a40;
        }
        .stats-card {
            border: none;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }
        .stats-card:hover {
            transform: translateY(-5px);
        }
        .stats-icon {
            font-size: 2.5rem;
            color: #0d6efd;
        }
        .risk-factor-bar {
            height: 25px;
            border-radius: 12.5px;
            transition: width 0.6s ease;
        }
        .chart-container {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .correlation-cell {
            width: 50px;
            height: 50px;
            transition: background-color 0.3s ease;
        }
        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: #0d6efd;
        }
        .stat-label {
            font-size: 1rem;
            color: #6c757d;
        }
        .nav-pills .nav-link {
            border-radius: 10px;
            padding: 10px 20px;
            margin: 5px;
            color: #495057;
        }
        .nav-pills .nav-link.active {
            background-color: #0d6efd;
            color: white;
        }
    </style>
</head>
<body>
    <div class="container py-5">
        <h1 class="text-center mb-5">Heart Disease Statistics & Insights</h1>

        <!-- Navigation Pills -->
        <ul class="nav nav-pills mb-4 justify-content-center" id="statsTabs" role="tablist">
            <li class="nav-item">
                <a class="nav-link active" data-bs-toggle="pill" href="#overview">Overview</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-bs-toggle="pill" href="#riskFactors">Risk Factors</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-bs-toggle="pill" href="#correlations">Correlations</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-bs-toggle="pill" href="#visualizations">Visualizations</a>
            </li>
        </ul>

        <!-- Tab Content -->
        <div class="tab-content">
            <!-- Overview Tab -->
            <div class="tab-pane fade show active" id="overview">
                <div class="row g-4">
                    <!-- Total Patients Card -->
                    <div class="col-md-3">
                        <div class="card stats-card h-100">
                            <div class="card-body text-center">
                                <i class="fas fa-users stats-icon mb-3"></i>
                                <h3 class="stat-value" id="totalPatients">-</h3>
                                <p class="stat-label">Total Patients</p>
                            </div>
                        </div>
                    </div>
                    <!-- Disease Rate Card -->
                    <div class="col-md-3">
                        <div class="card stats-card h-100">
                            <div class="card-body text-center">
                                <i class="fas fa-heartbeat stats-icon mb-3"></i>
                                <h3 class="stat-value" id="diseaseRate">-</h3>
                                <p class="stat-label">Disease Rate</p>
                            </div>
                        </div>
                    </div>
                    <!-- Average Age Card -->
                    <div class="col-md-3">
                        <div class="card stats-card h-100">
                            <div class="card-body text-center">
                                <i class="fas fa-calendar-alt stats-icon mb-3"></i>
                                <h3 class="stat-value" id="avgAge">-</h3>
                                <p class="stat-label">Average Age</p>
                            </div>
                        </div>
                    </div>
                    <!-- Gender Distribution Card -->
                    <div class="col-md-3">
                        <div class="card stats-card h-100">
                            <div class="card-body text-center">
                                <i class="fas fa-venus-mars stats-icon mb-3"></i>
                                <h3 class="stat-value" id="genderRatio">-</h3>
                                <p class="stat-label">Male/Female Ratio</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Risk Factors Tab -->
            <div class="tab-pane fade" id="riskFactors">
                <div class="card stats-card">
                    <div class="card-body">
                        <h4 class="mb-4">Risk Factors Analysis</h4>
                        <div id="riskFactorsContent"></div>
                    </div>
                </div>
            </div>

            <!-- Correlations Tab -->
            <div class="tab-pane fade" id="correlations">
                <div class="card stats-card">
                    <div class="card-body">
                        <h4 class="mb-4">Feature Correlations</h4>
                        <div class="chart-container">
                            <img id="correlationHeatmap" class="img-fluid" alt="Correlation Heatmap">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Visualizations Tab -->
            <div class="tab-pane fade" id="visualizations">
                <div class="row g-4">
                    <div class="col-md-6">
                        <div class="card stats-card">
                            <div class="card-body">
                                <h4 class="mb-4">Age Distribution</h4>
                                <div class="chart-container">
                                    <img id="ageDistribution" class="img-fluid" alt="Age Distribution">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card stats-card">
                            <div class="card-body">
                                <h4 class="mb-4">Risk by Age Group</h4>
                                <div class="chart-container">
                                    <img id="ageRisk" class="img-fluid" alt="Risk by Age Group">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Fetch and display statistics
        async function fetchStatistics() {
            try {
                // Fetch basic statistics
                const basicResponse = await fetch('/api/statistics/basic');
                const basicData = await basicResponse.json();
                if (basicData.status === 'success') {
                    const stats = basicData.data;
                    
                    // Update overview cards
                    document.getElementById('totalPatients').textContent = stats.dataset_stats.total_patients;
                    document.getElementById('diseaseRate').textContent = stats.dataset_stats.disease_percentage + '%';
                    document.getElementById('avgAge').textContent = stats.age_stats.mean_age;
                    document.getElementById('genderRatio').textContent = 
                        `${stats.gender_stats.male_count}/${stats.gender_stats.female_count}`;
                }

                // Fetch risk factors
                const riskResponse = await fetch('/api/statistics/risk_factors');
                const riskData = await riskResponse.json();
                if (riskData.status === 'success') {
                    displayRiskFactors(riskData.data);
                }

                // Fetch plots
                const plotsResponse = await fetch('/api/statistics/plots');
                const plotsData = await plotsResponse.json();
                if (plotsData.status === 'success') {
                    document.getElementById('correlationHeatmap').src = 'data:image/png;base64,' + plotsData.data.correlation_heatmap;
                    document.getElementById('ageDistribution').src = 'data:image/png;base64,' + plotsData.data.age_distribution;
                    document.getElementById('ageRisk').src = 'data:image/png;base64,' + plotsData.data.age_risk;
                }
            } catch (error) {
                console.error('Error fetching statistics:', error);
            }
        }

        function displayRiskFactors(riskFactors) {
            const container = document.getElementById('riskFactorsContent');
            container.innerHTML = '';

            // Age Groups
            const ageGroupsHtml = `
                <div class="mb-4">
                    <h5>Risk by Age Group</h5>
                    ${Object.entries(riskFactors.age_groups).map(([group, risk]) => `
                        <div class="mb-2">
                            <div class="d-flex justify-content-between mb-1">
                                <span>${group}</span>
                                <span>${risk.toFixed(1)}%</span>
                            </div>
                            <div class="progress">
                                <div class="progress-bar bg-primary" role="progressbar" 
                                     style="width: ${risk}%" aria-valuenow="${risk}" 
                                     aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;

            // Gender Risk
            const genderHtml = `
                <div class="mb-4">
                    <h5>Risk by Gender</h5>
                    <div class="mb-2">
                        <div class="d-flex justify-content-between mb-1">
                            <span>Male</span>
                            <span>${riskFactors.gender.male.toFixed(1)}%</span>
                        </div>
                        <div class="progress">
                            <div class="progress-bar bg-primary" role="progressbar" 
                                 style="width: ${riskFactors.gender.male}%" 
                                 aria-valuenow="${riskFactors.gender.male}" 
                                 aria-valuemin="0" aria-valuemax="100"></div>
                        </div>
                    </div>
                    <div class="mb-2">
                        <div class="d-flex justify-content-between mb-1">
                            <span>Female</span>
                            <span>${riskFactors.gender.female.toFixed(1)}%</span>
                        </div>
                        <div class="progress">
                            <div class="progress-bar bg-primary" role="progressbar" 
                                 style="width: ${riskFactors.gender.female}%" 
                                 aria-valuenow="${riskFactors.gender.female}" 
                                 aria-valuemin="0" aria-valuemax="100"></div>
                        </div>
                    </div>
                </div>
            `;

            container.innerHTML = ageGroupsHtml + genderHtml;
        }

        // Initialize statistics on page load
        document.addEventListener('DOMContentLoaded', fetchStatistics);
    </script>
</body>
</html>
