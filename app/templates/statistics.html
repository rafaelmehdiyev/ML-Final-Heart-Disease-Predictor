<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Heart Disease Statistics & Insights</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
            color: #343a40;
        }
        .stats-card {
            border: none;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }
        .stats-card:hover {
            transform: translateY(-5px);
        }
        .stats-icon {
            font-size: 2.5rem;
            color: #0d6efd;
        }
        .risk-factor-bar {
            height: 25px;
            border-radius: 12.5px;
            transition: width 0.6s ease;
        }
        .chart-container {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .correlation-cell {
            width: 50px;
            height: 50px;
            transition: background-color 0.3s ease;
        }
        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: #0d6efd;
        }
        .stat-label {
            font-size: 1rem;
            color: #6c757d;
        }
        .nav-pills .nav-link {
            border-radius: 10px;
            padding: 10px 20px;
            margin: 5px;
            color: #495057;
        }
        .nav-pills .nav-link.active {
            background-color: #0d6efd;
            color: white;
        }
    </style>
</head>
<body>
    <div class="container py-5">
        <h1 class="text-center mb-5">Heart Disease Statistics & Insights</h1>

        <!-- Navigation Pills -->
        <ul class="nav nav-pills mb-4 justify-content-center" id="statsTabs" role="tablist">
            <li class="nav-item">
                <a class="nav-link active" data-bs-toggle="pill" href="#overview">Overview</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-bs-toggle="pill" href="#riskFactors">Risk Factors</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-bs-toggle="pill" href="#correlations">Correlations</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-bs-toggle="pill" href="#visualizations">Visualizations</a>
            </li>
        </ul>

        <!-- Tab Content -->
        <div class="tab-content">
            <!-- Overview Tab -->
            <div class="tab-pane fade show active" id="overview">
                <div class="row g-4">
                    <!-- Total Patients Card -->
                    <div class="col-md-3">
                        <div class="card stats-card h-100">
                            <div class="card-body text-center">
                                <i class="fas fa-users stats-icon mb-3"></i>
                                <h3 class="stat-value" id="totalPatients">-</h3>
                                <p class="stat-label">Total Patients</p>
                            </div>
                        </div>
                    </div>
                    <!-- Disease Rate Card -->
                    <div class="col-md-3">
                        <div class="card stats-card h-100">
                            <div class="card-body text-center">
                                <i class="fas fa-heartbeat stats-icon mb-3"></i>
                                <h3 class="stat-value" id="diseaseRate">-</h3>
                                <p class="stat-label">Disease Rate</p>
                            </div>
                        </div>
                    </div>
                    <!-- Average Age Card -->
                    <div class="col-md-3">
                        <div class="card stats-card h-100">
                            <div class="card-body text-center">
                                <i class="fas fa-calendar-alt stats-icon mb-3"></i>
                                <h3 class="stat-value" id="avgAge">-</h3>
                                <p class="stat-label">Average Age</p>
                            </div>
                        </div>
                    </div>
                    <!-- Gender Distribution Card -->
                    <div class="col-md-3">
                        <div class="card stats-card h-100">
                            <div class="card-body text-center">
                                <i class="fas fa-venus-mars stats-icon mb-3"></i>
                                <h3 class="stat-value" id="maleToFemale">-</h3>
                                <p class="stat-label">Male/Female Ratio</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="overviewChart"></canvas>
                </div>
            </div>

            <!-- Risk Factors Tab -->
            <div class="tab-pane fade" id="riskFactors">
                <div class="card stats-card">
                    <div class="card-body">
                        <h4 class="mb-4">Risk Factors Analysis</h4>
                        <div id="riskFactorsContent"></div>
                    </div>
                </div>
            </div>

            <!-- Correlations Tab -->
            <div class="tab-pane fade" id="correlations">
                <div class="card stats-card">
                    <div class="card-body">
                        <h4 class="mb-4">Feature Correlations</h4>
                        <div class="chart-container">
                            <img id="correlationHeatmap" class="img-fluid" alt="Correlation Heatmap">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Visualizations Tab -->
            <div class="tab-pane fade" id="visualizations">
                <div class="row g-4">
                    <div class="col-md-6">
                        <div class="card stats-card">
                            <div class="card-body">
                                <h4 class="mb-4">Blood Pressure Distribution</h4>
                                <div class="chart-container">
                                    <canvas id="bpChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card stats-card">
                            <div class="card-body">
                                <h4 class="mb-4">Chest Pain Types</h4>
                                <div class="chart-container">
                                    <canvas id="cpChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        async function fetchStatistics() {
            try {
                const response = await fetch('/api/statistics');
                const data = await response.json();
                
                if (data.status === 'success') {
                    // Update overview cards
                    document.getElementById('totalPatients').textContent = data.dataset_stats.total_patients;
                    document.getElementById('diseaseRate').textContent = data.dataset_stats.disease_percentage + '%';
                    document.getElementById('avgAge').textContent = data.age_stats.mean_age;
                    document.getElementById('maleToFemale').textContent = 
                        `${data.gender_stats.male_count}:${data.gender_stats.female_count}`;

                    // Update risk factors
                    displayRiskFactors(data.risk_factors);
                    
                    // Create overview chart
                    const ctx = document.getElementById('overviewChart').getContext('2d');
                    new Chart(ctx, {
                        type: 'doughnut',
                        data: {
                            labels: ['Healthy', 'Heart Disease'],
                            datasets: [{
                                data: [
                                    data.dataset_stats.healthy_count,
                                    data.dataset_stats.disease_count
                                ],
                                backgroundColor: ['#28a745', '#dc3545']
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'bottom'
                                }
                            }
                        }
                    });

                    // Update correlations
                    if (data.correlations) {
                        displayCorrelations(data.correlations);
                    }
                    
                    // Create visualizations
                    createVisualizations(data);
                } else {
                    console.error('Error in data:', data.message);
                }
            } catch (error) {
                console.error('Error fetching statistics:', error);
            }
        }

        function displayRiskFactors(riskFactors) {
            const container = document.getElementById('riskFactorsContent');
            container.innerHTML = ''; // Clear existing content
            
            if (!riskFactors) {
                container.innerHTML = '<p class="text-center">No risk factor data available</p>';
                return;
            }
            
            // Create sections for each risk factor category
            const categories = {
                'blood_pressure': 'Blood Pressure Levels',
                'chest_pain': 'Chest Pain Types',
                'gender': 'Gender'
            };
            
            for (const [category, title] of Object.entries(categories)) {
                const data = riskFactors[category];
                if (!data) continue;
                
                const section = document.createElement('div');
                section.className = 'mb-4';
                section.innerHTML = `<h4 class="mb-3">${title}</h4>`;
                
                for (const [key, value] of Object.entries(data)) {
                    const label = key.charAt(0).toUpperCase() + key.slice(1).replace(/_/g, ' ');
                    const percentage = value.toFixed(1);
                    
                    section.innerHTML += `
                        <div class="mb-3">
                            <div class="d-flex justify-content-between mb-1">
                                <span>${label}</span>
                                <span>${percentage}%</span>
                            </div>
                            <div class="progress">
                                <div class="progress-bar" role="progressbar" 
                                     style="width: ${percentage}%" 
                                     aria-valuenow="${percentage}" 
                                     aria-valuemin="0" 
                                     aria-valuemax="100">
                                </div>
                            </div>
                        </div>`;
                }
                
                container.appendChild(section);
            }
        }

        function createVisualizations(data) {
            if (!data.risk_factors) return;

            // Blood Pressure Distribution
            if (data.risk_factors.blood_pressure) {
                const bpCtx = document.getElementById('bpChart').getContext('2d');
                new Chart(bpCtx, {
                    type: 'bar',
                    data: {
                        labels: Object.keys(data.risk_factors.blood_pressure),
                        datasets: [{
                            label: 'Risk Percentage',
                            data: Object.values(data.risk_factors.blood_pressure),
                            backgroundColor: '#0d6efd'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 100
                            }
                        }
                    }
                });
            }

            // Chest Pain Types
            if (data.risk_factors.chest_pain) {
                const cpCtx = document.getElementById('cpChart').getContext('2d');
                new Chart(cpCtx, {
                    type: 'bar',
                    data: {
                        labels: Object.keys(data.risk_factors.chest_pain),
                        datasets: [{
                            label: 'Risk Percentage',
                            data: Object.values(data.risk_factors.chest_pain),
                            backgroundColor: '#0d6efd'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 100
                            }
                        }
                    }
                });
            }
        }

        // Initialize statistics on page load
        document.addEventListener('DOMContentLoaded', fetchStatistics);
    </script>
</body>
</html>
